<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title th:text="#{title.product}">Product Details</title>

    <!-- Boootstrap for carousel -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>

<a href="/search" th:text="#{link.backToSearch}">Back to Search</a>

<h1 th:text="${product.productName}"></h1>

<div class="product-container">

    <!-- Main carousel function -->
    <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">

        <div class="carousel-inner">

            <!-- main image loaded -->
            <div class="carousel-item active">
                <img th:src="@{'/images/large/' + ${product.productId} + '/' + ${product.featureImage}}"
                     class="d-block w-100"
                     alt="Product Image">
            </div>

            <!-- loads extra images -->
            <div th:each="img : ${additionalImages}" class="carousel-item">
                <img th:src="@{'/images/large/' + ${product.productId} + '/' + ${img}}"
                     class="d-block w-100"
                     alt="Product Image">
            </div>

        </div>

        <!-- buttons for switching images -->
        <button class="carousel-control-prev" type="button"
                data-bs-target="#productCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>

        <button class="carousel-control-next" type="button"
                data-bs-target="#productCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>

    </div>


    <!-- Product info -->
    <div class="product-info">

        <p><strong th:text="#{label.category}">Category:</strong>
            <span th:text="${product.categoryId.categoryName}"></span>
        </p>

        <p><strong th:text="#{label.description}">Description:</strong>
            <span th:text="${product.description}"></span>
        </p>

        <p><strong th:text="#{label.price}">Price:</strong>
            €<span th:text="${product.price}"></span>
        </p>

        <p th:if="${product.discountedPrice != null}">
            <strong th:text="#{label.discountedPrice}">Discounted Price:</strong>
            €<span th:text="${product.discountedPrice}"></span>
        </p>

        <p><strong th:text="#{label.size}">Size:</strong> <span th:text="${product.size}"></span></p>
        <p><strong th:text="#{label.colour}">Colour:</strong> <span th:text="${product.colour}"></span></p>
        <p><strong th:text="#{label.material}">Material:</strong> <span th:text="${product.material}"></span></p>

        <p><strong th:text="#{label.sustainability}">Sustainability Rating:</strong>
            <span th:text="${product.sustainabilityRating}"></span>/5
        </p>

        <p><strong th:text="#{label.manufacturer}">Manufacturer:</strong>
            <span th:text="${product.manufacturer}"></span>
        </p>

        <p><strong th:text="#{label.releaseDate}">Release Date:</strong>
            <span th:text="${#dates.format(product.releaseDate, 'yyyy-MM-dd')}"></span>
        </p>

        <p><strong th:text="#{label.supplier}">Supplier:</strong>
            <span th:text="${product.supplierId.supplierName}"></span>
        </p>

    </div>
</div>

<hr>

<!-- Review section -->
<hr>

<h2 th:text="#{header.reviews}">Customer Reviews</h2>


<!-- call to method for calculating average rating -->
<div th:if="${avgRating != null}">
    <h3>
        <span th:text="#{label.averageRating}">Average Rating:</span>
        <strong th:text="${#numbers.formatDecimal(avgRating, 1, 1)}"></strong>/5 of
        <span th:text="#{label.outOfReviews(${totalReviews})}"></span>
    </h3>
</div>

<div th:if="${avgRating == null}">
    <h3 th:text="#{label.noReviews}">No reviews yet.</h3>
</div>


<div th:if="${product.reviewList.size() == 0}">
    <p th:text="#{label.noReviews}">No reviews yet.</p>
</div>


<!-- Filter reviews to show only those 3 and above-->
<ul class="review-list" th:each="r : ${filteredReviews}">
    <li class="review-item">
        <p>
            <strong th:text="${r.customerId.firstName}"></strong>
            —
            <span th:text="${#dates.format(r.reviewDate, 'yyyy-MM-dd')}"></span>
        </p>
        <p>
            <span th:text="${r.customerId.city}"></span>
        </p>
        <p>
            <strong th:text="${r.rating}"></strong>/5
        </p>

        <p th:text="${r.reviewText}"></p>

        <hr>
    </li>
</ul>


<!-- Inventory info -->
<h2 th:text="#{header.inventory}">Inventory</h2>

<table>
    <thead>
    <tr>
        <th th:text="#{column.inventoryId}">Inventory ID</th>
        <th th:text="#{column.inStock}">In Stock</th>
        <th th:text="#{column.reserved}">Reserved</th>
        <th th:text="#{column.reorderPoint}">Reorder Point</th>
    </tr>
    </thead>

    <tbody>
    <tr th:each="i : ${product.inventoryList}">
        <td th:text="${i.inventoryId}"></td>
        <td th:text="${i.quantityInStock}"></td>
        <td th:text="${i.quantityReserved}"></td>
        <td th:text="${i.reorderPoint}"></td>
    </tr>
    </tbody>
</table>

<hr>

<!-- Language Switcher -->
<a href="?lang=en">English</a> |
<a href="?lang=fr">Français</a> |
<a href="?lang=es">Español</a>


<!-- More bootstrap linking -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


</body>
</html>

